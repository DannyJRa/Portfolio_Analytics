---
title: "Untitled"
output: html_document
---

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and Microsoft Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **R Tools | Publish | Preview** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r}
OrderType="TSL"
OrderDate="2017-11-03"
OrderFeature1=64
OrderFeatures2= 0.08
```

You can also embed plots, for example:

```{r, echo=FALSE}

library(quantmod)

#getSymbols("AAPL", src = 'yahoo')
#df <- data.frame(Date = index(AAPL), coredata(AAPL))
#df <- tail(df, 30)



library(dplyr)
library(plotly)
#QuotesDF = as.data.frame(Quotes)
#Quotes$date=as.Date(Quotes$date)
df_plotx <- filter(Quotes, symbol == "2PP.F",date>="2017-11-01")

tail(df_plotx)

```

```{r}

trigger = OrderFeature1
    
(triggerDate=df_plotx$date[which(df_plotx$high > trigger)])

```


```{r}
#######################3
# cutom colors
i <- list(line = list(color = '#FFD700'))
d <- list(line = list(color = '#0000ff'))
###########################

# annotation
a <- list(text = "Stock Split",
          x = '2017-11-03',
          y = 1.02,
          xref = 'x',
          yref = 'paper',
          xanchor = 'left',
          showarrow = FALSE
          )

# use shapes to create a line
l <- list(type = line,
          x0 = '2017-11-03',
          x1 = '2017-11-03',
          y0 = 0,
          y1 = 1,
          xref = 'x',
          yref = 'paper',
          line = list(color = 'black',
                      width = 0.5)
          )

p <- df_plotx %>%
    plot_ly(x = ~date, type = "ohlc",
          open = ~open, close = ~close,
          high = ~high, low = ~low
          ##############33
          #custom colors
          ,increasing = i, decreasing = d
          ###############3
          ) %>%
          layout(title = "Custom Colors",
         annotations = a,
         shapes = l)

p



################
#Save plotly:

### PhantomJS needed
### webshot needed
export(p, file = "image.jpeg")
#You can even change the file type of output by selecting the extension as .png, jpeg or .pdf.
#You can also save the image in html file which allows you the plotly experience like zooming or showing annotations by using htmlwidgets::saveWidget:


htmlwidgets::saveWidget(p, file = "image.html")


```

```{r}
##Source Telegram API
source("R:/7_DataScience/01_R/11_Telegram/telegram_botDR.R")

## Create Message
############
text = paste("Order executed on", triggerDate)
############


## Send some messages..

bot$sendMessage(text)
bot$sendPhoto('image.jpeg', caption = 'This is my awesome graph')
bot$sendPhoto('image.html', caption = 'This is my awesome graph')
```



